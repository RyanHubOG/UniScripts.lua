-- UniScript BETA — AirHub UI + Right-Click Aimlock + Infinite Sprint + Melee Aura + NoClip
local Players = game:GetService("Players")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera
local UIS = game:GetService("UserInputService")
local RunService = game:GetService("RunService")

-- =========================
-- Load AirHub UI
-- =========================
local AirHub = loadstring(game:HttpGet("https://raw.githubusercontent.com/airhub-org/AirHub-UI/main/Source.lua"))()
local Window = AirHub:Window("Criminality Enhancer | UniScript BETA","By Ryan")

local CombatTab = Window:Tab("Combat")
local MiscTab = Window:Tab("Misc")
local ExtrasTab = Window:Tab("Extras")

-- =========================
-- Settings
-- =========================
local Settings = {
    AimlockEnabled=false,
    AimlockPrediction=0.18,
    WallbangEnabled=false,
    MeleeAuraEnabled=false,
    MeleeReach=10,
    NoClipEnabled=false,
    InfiniteSprint=false,
    PlayerFOV=Camera.FieldOfView or 70
}

-- =========================
-- Combat Features
-- =========================
CombatTab:Toggle("Aimlock (Right-Click)", false, function(value)
    Settings.AimlockEnabled = value
end)

CombatTab:Toggle("Wallbang", false, function(value)
    Settings.WallbangEnabled = value
end)

CombatTab:Toggle("Melee Aura", false, function(value)
    Settings.MeleeAuraEnabled = value
end)

CombatTab:Slider("Melee Reach",1,30,Settings.MeleeReach,function(value)
    Settings.MeleeReach = value
end)

-- =========================
-- Misc Features
-- =========================
MiscTab:Toggle("NoClip", false, function(value)
    Settings.NoClipEnabled = value
end)

MiscTab:Toggle("Infinite Sprint", false, function(value)
    Settings.InfiniteSprint = value
end)

MiscTab:Slider("Player FOV",70,120,Settings.PlayerFOV,function(value)
    Settings.PlayerFOV = value
    Camera.FieldOfView = value
end)

-- =========================
-- Extras
-- =========================
ExtrasTab:Button("Copy Discord",function()
    setclipboard("https://discord.gg/dJEM47ZtGa")
end)

ExtrasTab:Button("Unload Script",function()
    Window:Unload()
end)

-- =========================
-- Aimlock Logic
-- =========================
local aimlockSpeed = 0.25
local aimlockPos = Vector2.new(Camera.ViewportSize.X/2,Camera.ViewportSize.Y/2)

local function getClosestPlayer()
    local closestPlayer = nil
    local shortestDistance = math.huge
    for _, player in ipairs(Players:GetPlayers()) do
        if player.Character and player.Character:FindFirstChild("HumanoidRootPart") and player ~= LocalPlayer then
            local screenPos, onScreen = Camera:WorldToScreenPoint(player.Character.HumanoidRootPart.Position)
            if onScreen then
                local distance = (Vector2.new(screenPos.X, screenPos.Y) - aimlockPos).Magnitude
                if distance < shortestDistance then
                    closestPlayer = player
                    shortestDistance = distance
                end
            end
        end
    end
    return closestPlayer
end

local function aimlock()
    if Settings.AimlockEnabled then
        local target = getClosestPlayer()
        if target and target.Character and target.Character:FindFirstChild("Head") then
            local targetPos = Camera:WorldToScreenPoint(target.Character.Head.Position)
            local direction = (Vector2.new(targetPos.X, targetPos.Y) - aimlockPos).Unit
            aimlockPos = aimlockPos + direction * aimlockSpeed
            Camera.CFrame = Camera.CFrame:Lerp(CFrame.new(Camera.CFrame.Position, Camera.CFrame.Position + direction), Settings.AimlockPrediction)
        end
    end
end

UIS.InputBegan:Connect(function(input, gp)
    if not gp and input.UserInputType == Enum.UserInputType.MouseButton2 then
        Settings.AimlockEnabled = true
    end
end)

UIS.InputEnded:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton2 then
        Settings.AimlockEnabled = false
    end
end)

-- =========================
-- Infinite Sprint (optimized)
-- =========================
local function applyInfiniteSprint()
    for _,tbl in pairs(getgc(true)) do
        if type(tbl)=="table" and rawget(tbl,"S") then
            rawset(tbl,"S",100)
        end
    end
end

-- =========================
-- Melee Aura (Reach Attack)
-- =========================
local function meleeAura()
    for _, player in pairs(Players:GetPlayers()) do
        if player ~= LocalPlayer and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
            local distance = (player.Character.HumanoidRootPart.Position - LocalPlayer.Character.HumanoidRootPart.Position).Magnitude
            if distance <= Settings.MeleeReach then
                -- Trigger punch (replace this with your game’s melee function)
                if player.Character:FindFirstChild("Humanoid") then
                    player.Character.Humanoid:TakeDamage(1)
                end
            end
        end
    end
end

-- =========================
-- Main Loop
-- =========================
RunService.RenderStepped:Connect(function()
    -- Aimlock
    aimlock()

    -- Infinite Sprint
    if Settings.InfiniteSprint then applyInfiniteSprint() end

    -- Melee Aura
    if Settings.MeleeAuraEnabled then meleeAura() end

    -- Player FOV
    Camera.FieldOfView = Settings.PlayerFOV

    -- NoClip
    if Settings.NoClipEnabled and LocalPlayer.Character then
        for _,part in pairs(LocalPlayer.Character:GetChildren()) do
            if part:IsA("BasePart") then part.CanCollide = false end
        end
    end
end)

print("✅ UniScript loaded with AirHub UI, Aimlock, Infinite Sprint, Melee Aura, NoClip")
